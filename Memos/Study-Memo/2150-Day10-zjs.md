# 第十堂课总结

**<font size=4>航71  朱洁松  2017012150</font>**

## 股票协整性和配对交易

### 股票的配对交易

配对交易的基础是市场交易品种之间的协整性。

单只股票不具有平稳性，利用同一行业的两只股票之间的协整性可以构建一个均值回复的策略。

配对交易的要素：对冲比例、Spread、策略持有时间

如何做配对交易？

> 先进行协整性测试，找到配对
>
> 确定配对的持有比例（对冲比例）
>
> 计算半衰期，确定持有的时间
>
> 策略退出

股票的平稳性

> 如果时间序列从未偏离其初始值，则它是“平稳的”
>
> 大多数股票价格序列都不是平稳的，它们表现出几何上的随机游走，使得离起始点的价格越来越远

股票的协整性

> 可以找到一对股票，如果做多其中一只股票而做空另一只股票，整个投资组合的市场价值是稳定的。
>
> 在这种情况下，这两个单独的时间序列就是协整的。通常形成协整对的两只股票来自同一个行业。
>
> 在协整对股票价差较低时买入组合，在价差较高时卖出组合。

### 配对交易案例

GLD  v.s  GDX

协整性测试

```python
from statsmodels.tsa.stattools import coint
coint_t, pvalue, crit_value=coint(df['Adj Close_GLD'], df['Adj Close_GDX'])
# 95%的置信区间要求abs(coint_t)>1.96,pvalue<5%=0.05
```

计算对冲比例

```python
from statsmodels.api import OLS
model=OLS(df['Adj Close_GLD'], df['Adj Close_GDX'])
results=model.fit()
hedgeRatio=results.params
```

价格差（Spread）

```python
# 需考虑对冲比例
spread=df['Adj Close_GLD']-hedgeRatio[0]*df['Adj Close_GDX']
```

确定策略持有时间

> 最佳持有时间通常会随着信息传播速度的加快和抓住这个交易机会的交易员数量的增加而减少
>
> 有效市场假说 -> 信息的传播 -> 不再存在错误定价 ->  套利机会的消失
>
> 策略有效性的变化、市场环境的变化

```python
z = spread
prevz=z.shift()

dz=z-prevz

dz=dz[1:,]

prevz=prevz[1:,]

model2=OLS(dz, prevz-np.mean(prevz))

results2=model2.fit()

theta=results2.params

halflife=-np.log(2)/theta
```

> Ornstein-Uhlenbeck公式：
>
> $dz(t)=-\theta(z(t)-\mu)dt+dw$
>
> $\mu$ 随着时间推移的价格均值，dw是一个随机的高斯噪声。给定一个日常传播的时间序列值，我们可以很容易的找到 $\theta$
>
> z的平均值意味着 $\mu$ 指数衰减，这个指数衰变的半衰期等于 $ln(2)/\theta$ ，这是预期的时间扩散到恢复到初始平均偏差的一半。此半衰期可以用于确定均值回复位置的最佳保持时间。

### 相关性 VS 协整性

两个价格序列之间的相关性实际上是指他们在一段时间内（一天）收益率的相关性。

如果两只股票是正相关的，那么他们的价格很有可能在大多数的日子里朝着同一个方向变动。

然而，正相关并不能说明这两只股票的长期表现。特别是，这并不能保证股票价格在长期内不会变得越来越差。既是他们在大多数日子里朝着同一个方向移动。

然而，如果两只股票是协整的，并且未来仍然如此，它们的价格（适当的加权）将不太可能出现分歧。然而它们每天的回报可能是完全不相关的。

```python
# 计算每日收益率
dailyret=df.loc[:, ('Adj Close_KO', 'Adj Close_PEP')].pct_change()
# 计算相关系数
dailyret.corr().dropna()
```

相关性是指两只股票收益率的相关性。

协整性是指两只股票价格的多空组合是平稳的

## 期权

### 期权的定义和规则

期权的定义

> 期权是一种在现货、期货或指数等品种基础上的金融衍生品。它是在未来某个时刻以特定价格买入或卖出某项标的的资产的权力
>
> 购房定金，锁定买入价，应对价格上涨的风险。认购期权
>
> 粮食最低收购价，锁定卖出价，应对价格下跌的风险。认沽期权

已上市的期权品种

> 商品期货期权：豆粕期权（大商所）、白糖期权（郑商所）、沪铜期权（上期所）、棉花、铁矿、橡胶
>
> 股指期权：沪深300股指期权（中金所）
>
> 股票期权：上证50ETF期权（上交所）、沪深300ETF期权（上交所、深交所）

行权方式

> 欧式期权：只能在到期日当天行使权力（电影票）。股票期权都是欧式期权。
>
> 美式期权：到期前任何一天都可以行使权力（月饼券）。
>
> 只是行权能力不同，都可以随意交易。

期权合约交易

> 以金融衍生品作为行权品种的交易合约。指在特定时间内以特定价格买卖一定数量交易品种的权力。
>
> 合约买入者或持有者以支付保证金—期权费的方式拥有权利；合约卖出者或立权者收取期权费的方式拥有权利；合约卖出者或立权者收取期权费，在买入者希望行权时，必须履行义务。

合约要素

> 合约标的、合约类型、合约单位、合约到期月份、行权价格、行权方式、交割方式、到期日

交易制度

> 交易所、交易时间、买卖类型（买入开仓、买入平仓、卖出开仓、卖出平仓、备兑开仓、备兑平仓）、最小报价单位（0.0001元）、申报单位（1张或其整数倍）、行权日、认购合约申报行权的条件（有足够资金认购合约）、认沽合约申报行权的条件（有足够可用证券）

50ETF购8月2100

> 有权在8月的第四个星期三，以2.100元/份的价格，从期权卖方手中买入合约单位数量的上证50ETF

到期损益图（到期收益曲线）（以认购期权为例）

![到期收益曲线](C:\Users\Administrator\Desktop\到期收益曲线.png)

> 评估风险收益特征：最大风险是期权价格。最大收益没有上限
>
> 计算损益平衡点：平衡点 = 行权价+期权价/认购数量(45°角)

### 期权交易的基本策略

交易角色

> 期权买方：支付权利金、享有权利。（投保人）
>
> 期权卖方：获得权利金、只有义务（缴纳保证金）。（保险公司）

交易动作

> 开仓操作（入场）：买入期权合约，新建立头寸
>
> 了结头寸（出场）：到期行权、提前平仓、到期归零（放弃行权）

### 期权的定价公式和影响因素

期权合约的三种状态

> 根据标的价格与行权价格的相对高低，认购认沽期权定义不同：
>
> 实值期权（认购期权：标的价格高于行权价格，要求行权）
>
> 平值期权
>
> 虚值期权（认股期权：标的价格高于行权价格，放弃行权）
>
> （期权价格是沉没成本）

期权定价

> 期权价格 = 内在价值 + 时间价值
>
> 内在价值：期权当前立即到期，买方通过行权获取的收益。（行权就是标的与行权的价差，不行权就是0）
>
> 时间价值：买方支付的权利金中超出当前内在价值的部分。（多的就算到时间价值中去）也是买方为了赚取未来市场可能的上涨而愿意付给卖方的成本，换取的是一种盈利的可能性。
>
> 时间价值随着期权到期日的减小而减小。

定价公式

> B-S模型的假设
>
> 标的资产为某风险资产，且其价格S的波动服从几何布朗运动
>
> $\frac{ds}{s}=\mu dt+\sigma dz$
>
> 在期权有效期内，标的资产没有现金收益支付
>
> 市场无摩擦，即不存在税收和交易成本
>
> 标的资产允许卖空，且所有证券都是无限可分的
>
> 在期权有效期内，无风险利率为常数，可以此利率无限制地借贷
>
> 该期权是欧式期权，即在期权到期前不可实施
>
> 市场不存在无风险套利机会
>
> 认购期权价格：$c = SN(d_1)-Ke^{-r(T-t)}N(d_2)$
>
> 认沽期权价格：$p = Ke^{-r(T-t)}N(-d_2)-SN(-d_1)$
>
> 其中，$d_1 = \frac{ln(\frac{S}{K})+(r+\frac{\sigma^2}{2})(T-t)}{\sigma\sqrt{T-t}}$     $d_2=d_1-\sigma\sqrt{T-t}$
>
> c：认购期权价格  p：认沽期权价格  S：标的资产价格  K：期权行权价  T-t：临到期时间 r：无风险利率  σ：标的价格年化波动率  N：标准正态分布变量的累积概率分布函数

隐含波动率

> 在期权有效期内标的资产的实际波动率。对于当前时刻是未知的。
>
> 可以将某个期权合约的成交价（权利金）及其它几个参数输入期权定价模型，通过计算得到
>
> 隐含波动率反映了市场对未来标的价格波动的看法或预期，是市场情绪的体现
>
> 当隐含波动率上升，代表投资者预期标的价格波动将扩大，因此权利金也会上涨；反之权利金则会下跌

影响期权价格的因素

> 标的价格风险、波动率风险、时间流逝风险








