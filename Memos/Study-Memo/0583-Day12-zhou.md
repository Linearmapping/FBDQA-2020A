###  课堂小结 周航宇 2017010583
### 量化策略的深入诊断
#### 量化策略开发基本流程 
+ 流程细则与技术方案选择
自动化操作：数据、统计分析、调试修正
+ 数据处理：数据对齐、管理配置、数据收集、数据校验、数据比对、数据清洗
+ 统计分析：鲁棒性分析、基础模型、统计检验、数据样本检验、协整分析、样本内外测试、过拟合检验
+ 调试修正：回测平台选择与特性；计算层面维度选择：TICK/MIN；策略层面基本逻辑；系统层面操作系统选择；编程语言层面；样本内外测试；再次进行鲁棒性检验
+ 解决问题：回测收益率高，实盘性能差距大；交易逻辑中是否存在隐蔽的问题，导致实盘中无法交易出来回测的结果
#### 鉴别回测中的虚高收益率是运气还是实力
+ 高收益
+ 造成回测中收益率虚高的原因：
	年化计算有bug，回测周期太短，赶上同期大盘好，回测周期碰巧抓到大牛股，过度拟合只适用于某个阶段，使用了未来函数。
+ 回测是否具有统计意义：回测阶段交易次数；是否违背了交易规则；是否在流动性缺失时也能正常成交；是否考虑了流动性对成交量的影响；是否国与理想化地使用了价格；是否存在偶然性影响。
#### 策略逻辑的隐蔽问题——未来函数
+ 典型情况：偷价、收盘价成交的问题
+ 财务/公告类指标的更新：按照证监会规定，在一定的时间范围内更新，但每家上市公司季报更新日期并不一致。第三方平台整理的财务类因子存在提前更新的情况。
+ 事件驱动型策略的问题
#### 量化策略诊断checklist
+ 回测多周期
+ 回测多起点
+ 样本外测试
+ 足够多的交易笔数
+ 检查关键指标
+ 检查交易记录
+ 策略交易逻辑
### 蒙特卡洛模拟
基于概率的方法，主要内容：随机数生成、随机变量、随机过程
+ 分布：均匀、正太、卡方、泊松
~~~python
import numpy as np
import numpy.random as npr
#均匀分布
a=5.
b=10.
npr.rand(10)*(b-a)+a
npr.rand(5,5)**(b-a)+a
#正态分布
npr.standard_normal(sample_size)
npr.normal(100,20,sample_size)
#卡方分布
npr.chisquare(df=0.5,size=sample_size)
#泊松分布
npr.poisson(lam=1.0,size=sample_size)
~~~
+ BSM公式
$S_T=S_0exp((r-\frac{1}{2}\sigma^2)T+\sigma\sqrt{T}z)$
$S_T$
+ 生成标准正态分布随机数
~~~python
S0=100
r=0.05
sigma=0.25
T=2.0
I=10000
ST1=S0*np.exp((r-0.5*sigma**2)*T+sigma*np.sqrt(T)*npr.standard_normal(I))
~~~
+ 对数正态分布
~~~python
ST2=S0*npr.lognormal((r-0.5*sigma**2)*T,sigma*np.sqrt(T),size=I)
~~~
+ 离散求解
~~~python
I=10000
M=50
dt=T/M
S=np.zeros((M+1,I))
S[0]=50
for t in range(1,M+1):
	S[t]=S[t-1]*np.exp((r-0.5*sigma**2)*dt+sigma*np.sqrt(dt)*npr.standard_normal(I))
~~~
### 期权估值
+ 欧式期权：看涨期权、看跌期权
+ 期权的风险中立预期定价
$C_0=e^{-rT}E(h(S_T))$
$h(S_T)=max(S_T-K,0)$
$h(S_T)=max(K-S_T,0)$
+ 使用蒙特卡洛模拟来近似该期望
$\widetilde C_0=e^{-rT}\frac{1}{I}\sum\limits_{i=1}^{I}h(\widetilde{S}^j_T)$
