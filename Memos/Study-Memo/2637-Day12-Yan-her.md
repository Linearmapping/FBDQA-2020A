# Week12

## 量化策略的深入诊断

### 数据的处理

数据校验：接收到的数据是否在high limit和low limit之间

……

数据对齐：用到不同品种的数据，比如alpha策略中股指期货是中金所，股票是上交所和深交所，不同交易所数据发布时间可能不同，要保证时间戳对齐

### 统计分析

基础建模

统计检验

……

### 调试修正
回测平台选择与特性：聚宽上手容易，且数据齐全，但不一定是实盘最好的选择
计算层面维度选择：TICK/MIN
操作系统选择：LINUX
编程语言：C++，python(不够快)
再次进行样本内外测试
再次进行鲁棒性检验

### 鉴别回测中的虚高收益率是运气还是实力
* 回测是否具有统计意义
	* 股票一买一卖、期货一开一平为一次交易
	* 一般不应该少于200次交易，价值投资交易次数少，也不应该少于70次
* 是否违背了交易规则
	* 避免停牌交易、临时停牌交易
* 是否在出现流动性缺失时也能正常成交
	* 涨跌停
	* 特殊涨跌停限制：新股、ST股、科创板/创业板
* 是否考虑了流动性对成交量的影响
	* 单笔成交量超过当日该股票池成交量的10%？
* 是否过于理想化地使用了价格
	* 日内出的信号，以开盘价成交？
	* 能否精确地以日内收盘价成交？（实际上不容易，但作业回测时可以用收盘价近似）
		* 实际上会用收盘10分钟的均价
* 是否存在偶然性影响
	* 相同条件下回测结果一致吗？
	* 比如纳入股票池的股票有50支，由于资金限制只能买10支，如果逻辑是随机挑选10支就可能每次回测都不一样，需要检查这种随机的影响多大，如果是可控的就没太大问题

### 未来函数

#### 几种典型情况
* 偷价
	* 查bug：一大清早就知道收盘价
	* 最低价买，最高价卖
	* 当日买入，当日卖出
* 收盘价成交的问题
	* 无法精确以收盘价成交
* 财务/财务公告类指标什么时候更新的
	* 基金重仓股的启示
	* 事件驱动型，先有鸡还是先有蛋

#### 财务/财务公告类指标什么时候更新
* 来源：上市公司季报
* 更新时间：
	* 按照证监会规定，在一定的时间范围内更新
	* 但每家上市公司的季报更新日期并不一致
* 第三方平台整理的财务类因子：
	* 存在“提前”更新的情况。（平台工程师可能在每季第一天更新财务信息，但实际上公司可能几个月后才发的公告，相当于提前知道财务信息）

#### 事件驱动型策略的问题
* 信息来源：上市公司公告、新闻
* 通常发布时间：交易日收盘后
	* 策略检测事件的时候可能当天就买入了，然后停牌一段时间再开盘连吃涨停板
* 通常发布后的动作：第二天停牌
* 通常复盘后的市场反应：连续涨停（或跌停）



### 自检手册
* 回测多周期：牛熊震荡市，避免受单一行情影响
* 回测多起点：比如2015年1月1日、2日、3日都测一遍，如果结果有很大差别可能有问题
* 样本外测试：调参数用2014-2015，回测不能还用2014-2015
* 足够多的交易比数
* 检查几个关键指标：夏普、最大回撤、年华、信息率、alpha、beta、**涨跌天数、逐笔收益分布**
* 检查交易记录：不能有任何未来函数，成交价格是否在合理范围，成本是否合理，核对基础数据，重点停复牌和复权
* 反思交易逻辑：纯拟合还是确实有逻辑
* *翻盘年数 = 最大回测/年华收益，越小越好（0.1以下）



## 蒙特卡洛模拟和期权估值



















