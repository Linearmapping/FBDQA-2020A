## 第十二讲：量化策略的深入诊断

欧式期权：不能提前行权

备兑策略：闭眼做有保障，需要长期坚持

$\alpha$，相对业绩基准组合的超额收益

量化策略的特点：解决认知偏差、情绪偏差，强调系统性、高效率、纪律性

研发流程：

​	基于宏观经济环境数据，基于行业与公司基本面，基于市场交易数据4

- 数据的处理
  - 数据收集
  - 数据校验
  - 数据比对
  - 数据清洗
  - 数据对齐（重要）
    - 如：股指期货（中金所）、股票（上/深交所），使用不同数据接口，发布行情的时间可能不同步
    - 什么时候触发动作：保证时间是一致的（对齐时间戳）
  - 管理配置

- 统计分析
  - 基础模型
  - 统计检验
  - 数据样本检验
  - 协整分析
  - 

- 调试修正

  - 回测平台的选择
    - 选择聚宽，包含大量历史数据，好上手；但未必是持盘的最佳选择
  - 计算层面维度选择：TICK/min。level1（）， level2（10ms）

- 鉴别回测中的虚高收益是运气还是实力

  - 造成虚高的原因

    - 年化计算有bug
    - 回测周期太短，赶上同期大盘好
    - 回测周期碰巧抓到大牛股（过拟合的一种）
    - 过度拟合，只适用于某个阶段（不要为了好看的回测曲线这么做）
    - 使用未来函数

    前四个比较容易避免
    
  - 回测是否具有统计意义
  
    - 经验值最低也需要70次交易（股票：一买一卖；商品期货：一开一平）
  
    - 是否违背了交易规则：停牌的股票不能成交，注意临时停牌的情况
    - 是否在出现流动性缺失时也能正常成交？
      - 涨停跌停
      - 特殊涨跌停限制：新股，ST股票，科创板/创业板（20cm）
    - 是否考虑了流动性对成交量的影响
      - 单笔成交量超过当日该股票成交量的10%
      - 尤其小市值股要留意
    - 是否过于理想化使用了价格
      - 日内出的信号，以开盘价成交
      - 是否精确地以日收盘价成交
    - 是否存在偶然性影响
      - 相同条件下回测结果一致吗（比如逻辑包括在资金有限的情况下，随机选择一些股票）

- 未来函数
  - 偷价
    - 查bug，可能是代码写的不规范
  - 收盘价成交的问题
  - 财务/公告类指标是什么时候更新的
      - 来源：上市公司季报
      - 每家上市公司的季报更新日期并不一致
      - 检验：基金重仓，同时被两家基金公司重仓的股票，则纳入股票池。结果很好，但实际基金重仓要么公司披露要么基金公司披露，占了两个月优势（这个信息会比实际基金公司重仓的时间晚两个月披露，但回测的时候会提前知道）
  - 事件驱动型策略的问题
      - 公告：通常发布时间：交易日收盘之后（16:00后），第二天直接停牌（资产重组）。但回测的时候，可能会由于信号代码的设计在公告发布当日以收盘价买入（which is impossible in reality）
  - 高频交易的成本和成交价

- 量化交易自建手册
  - 回测多周期
  - 回测多起点：避免偶然性影响（比如四年跨度，四天的起点，按道理差别不应该很大）
  - 样本外测试：不能调参数和回测用同一段时间测试，要验证延展性
  - 足够多的交易笔数：验证量化模型的统计意义
  - 检验几个关键指标：夏普、最大回撤、年化、信息率、索提诺比率、alpha、beta、涨跌天数（上涨天数、下跌天数）、每笔交易的收益分布
  - 检查交易记录：不能有未来函数，成交价格是否在合理范围、成本是否合理、核对基础数据、重点停复牌和复权
  - 以上均无问题，反思交易逻辑，是否只用了归纳法
  - 翻盘，忍受回撤的周期尽量短



### 蒙特卡洛模拟和期权估值

![](https://qn-st0.yuketang.cn/FuZ1lw3dYnXiE9qCfeSGz-38VBOK)

2. 应用：期权估值

![](https://qn-st0.yuketang.cn/Fo5IqLop11zYAHMO1U1u2fQPaBQS)

