# WW12

## 金融大数据：蒙特卡洛模拟

### 蒙特卡洛模拟

随机数`np.random.rand()`

正态分布`np.random.normal(u, sigma, size)`/`np.random.standard_normal(size)`

卡方分布`np.random.chisquare(df=)`

泊松分布`np.random.possion(lam=)`

#### 模拟股票指数

$$
S_T=S_0exp((r-(1/2)\sigma^2)T + \sigma\sqrt(T)z)
$$

* $S_0$今天的股指
* σ：恒定波动率
* z 标准正态分布随机变量

模拟方法

* 直接模拟
* $S_T/S_0$是对数正态分布
* 微分得到几何布朗运动
  * $dS_T=rS_Tdt+\sigma S_T dZ_t$
  * 离散化求解，以其计算下一步发概率
  * 使用蒙特卡罗模拟近似分布

### 应用：期权估值

欧式期权

看涨：$h(S_T)=max(S_T-K,0)$

看跌：$h(S_T)=max(K-S_T,0)$

风险的中立预期：$e^{-rT}E(h(S_T))$，指数项是把未来收益折算到现在（r是无风险利率）

## 量化策略：量化策略的深入诊断

国内能够参与的期权都是欧式期权。

备兑策略从长期来看是可以的。可以尝试的策略。（其他策略在实际中不要轻易尝试）

名词术语

* 数据对齐
* 柜台延迟
* 未来函数
* 事件驱动
* 压力测试
* 策略内外风控

### 量化策略开发的基本流程

宏观：整个市场的经济：基础利率，CPI，PPI

中观：行业与公司基本面：财报，分析师研报，产业链……

微观：市场交易数据，流动性分析，……

柜台延迟：一般CTP>300us；在高频交易中有影响

#### 数据处理

管理配置-数据收集-数据校验-数据比对-数据清洗-数据对齐

**数据对齐**

股指期货：中金所；股票交易所：上证，深证

各个机构发布时间不一致

#### 统计分析

基础模型-统计检验-数据样本检验-协整分析-样本内外测试-过拟合检验-鲁棒性分析

#### 调试修正

回测平台

维度：TICK/MIN

样本内外测试

鲁棒性检验

> 追求更快可以用汇编语言

### 收益率是运气还是实力？

一天0.1%，一年27%，超过巴菲特；高频交易可以达到年化100%，容量比较小。

#### 虚高的原因

* 年化计算有bug
* 回测周期短，刚好赶上大盘好
* 恰好抓到大牛股
* 过度拟合，只适合过去的阶段
* 使用了未来函数

#### 检查点

* 统计意义？
  * 回测阶段交易（一买一卖）次数：at least 70
* 是否违背交易规则？
  * 注意临时停牌的情况
* 流动性缺失时也能成交？
  * 涨停购买？跌停卖出？
  * 回测要求涨跌停不能买卖，注意不同股票的涨跌停限制。
* 流动性对成交量的影响
  * 限制流动性风险：日成交额不超过当天成交额的10%，2%
* 理想化地使用价格
  * 回测时，可以用收盘价成交（近似），实际中比较难拿到。实盘中在最后十分钟一步步卖，是一个均价。
* 偶然性影响
  * 完全相同条件下回测结果一致吗？
    * 策略中本身的随机因素 - 对结果影响大吗？

### 未来函数

时间靠后的数据不应对前面的数据产生影响。

* 偷价
  * T+1，当天买不能当天卖
* 收盘价成交
* 财务指标

#### 财务/公告类指标

上市公司季报披露

每家公司季报更新日期并不一致

注意第三方平台的信息是否使用了未来的信息

#### 事件驱动型策略

信息来源：上市公司公告、新闻

公告可能在4点之后发布

### 诊断checklist

* 多周期
* 多起点
* 样本外测试
* 足够的交易数量
* 关键指标：
  * 夏普，回撤，年化，信息率，索提诺比率，alpha，beta，涨跌天数，逐笔收益分布
* 交易记录：未来函数？成交价格？成本是否合理？基础数据。**停牌复牌，复权**
* 反思交易逻辑：只用了归纳法？